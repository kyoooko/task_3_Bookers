<header>
 <style>
    /* 本ページ */
  .book_title,.book_body{
    margin-bottom: 10px;
  }
  /* フォロー機能 */
  .follow-btn{
    width:100%;
  }
  /* 住所 */
  .map{
    margin-top:30px;
  }
  .adress{
     margin-top:30px;
  }
  /* Google マップ(CSS) */
  #map {
        height: 600px;
        width: 600px;
      }
  </style>
</head>

<body>
  <div class="container main-container">
    <p id="notice"></p>

    <div class="row">
      <!-- 左側 上 -->
      <div class="col-xs-3">
        <h2>User info</h2>
        <%= attachment_image_tag @user, :profile_image, size: "100x100",format: 'jpeg', class: "profile-img", fallback: "no_image.jpg" %>

        <table class="table">
          <tbody>
            <tr></tr> 
            <tr>
              <th>name</th>
              <th><%= @user.name %></th>
            </tr>
            <tr>
              <th>introduction</th>
              <th><%= @user.introduction %></th>
            </tr>
            <%# フォロー機能 %>
            <tr>
              <th>follows</th>
              <th><%= link_to "/users/#{@user.id}/follows",class:"books_show" do %><%= @user.followings.count %><% end %></th>
            </tr>
            <tr>
              <th>followers</th>
              <th><%= link_to "/users/#{@user.id}/followers",class:"books_show" do %><%= @user.followers.count %><% end %></th>
            </tr>
          </tbody>
        </table>
        <%# フォローボタン %>
        <div class="row">
            <%= render 'relationships/follow_button', user: @user %>
        </div>  
        <%# ユーザー編集ボタン %>
        <div class="row">
          <% if @user.id == current_user.id %>
            <%= link_to "",edit_user_path(@user.id), class:"col-xs-12 btn btn-default glyphicon glyphicon-wrench" %>
          <% else %>     
              <%= link_to "",user_path(current_user.id), class:"col-xs-12 btn btn-default glyphicon glyphicon-wrench" %>
          <% end %>
        </div>  

        <!-- 左側 下 -->
        <h2>New book</h2>
        <%= form_for(@book) do |f| %>
          <div class="field row">
            <%= f.label :title %><br />
            <%= f.text_field :title, autofocus: true, class:"col-xs-12 book_title",id:"book_title" %>
          </div>

          <div class="field row">
            <%= f.label :body,"Opinion" %><br />
            <%= f.text_area :body, autofocus: true,class:"col-xs-12 book_body",id:"book_body" %>
          </div>       

          <div class="actions row">
            <%= f.submit "Create Book",class:"btn btn-primary col-xs-12" ,data: { disable_with: "Sign up" } %>
          </div>
        <% end %>
      </div>
    
      <!-- 右側 -->
      <%= render 'books/books', books: @books %>
    </div>    
    
    <!-- 下（MAP) -->
    <% if @user == current_user %>
      <div class="row map">
        <div class="col-xs-12">
            <h2>Your Map</h2>
            <p class="adress">住所： 〒<%= @user.postal_code %>&emsp;<% @user.prefecture_code %>&ensp;<%= @user.city %>&ensp;<%= @user.street%></p>
            <p><% @user.address %></p>
            <%# Google マップ %>
            <div id='map' class="<%= @user.prefecture_code.to_s + @user.city + @user.street %>">
        </div>
      </div>
    <% end %>
  </div>

  <%# Google マップ(JS)  %>
  <script>
  /*関数の外で定義(codeAddressでも使うため)*/
    let map
    let geocoder
    // 最初の表示で次の処理をする
    function initMap(){
      // geocoderを初期化。住所を緯度経度に変換してくれる
      geocoder = new google.maps.Geocoder()
      // ジオコードオブジェクトを作成し、geocode()methodでGeocoderにリクエストを送信。addressとresults、statusはgeocodeが装備しているもの。.attrで住所を取り出しgeocodeメソッドの結果（緯度経度）をresultsに入れてる
      geocoder.geocode( { 'address': $('#map').attr('class')}, function(results, status) {
        // ステータスがOKなら
        if (status == 'OK') {
       // 中央を指定
          map.setCenter(results[0].geometry.location);
       // GoogleMap上の指定位置にマーカが立つ
          var marker = new google.maps.Marker({
              map: map,
              position: results[0].geometry.location
          });
        } else {
          alert('[Your Map] 該当する結果が見つかりませんでした：' + status);
        }
      });
      // 下記ないと表示できない
      map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 40.7828, lng: -73.9653},
      zoom: 8
      });
    }
    // 住所訂正する場合は下記必要
    // function codeAddress(){
    //   let inputAddress = document.getElementById('address').value;
    // }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
  <%# <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC7wALtCD2-jLMnFfdOUaxxfvOtA_wKqs8&callback=initMap" async defer></script> %>
</body>
 


        
            
          
